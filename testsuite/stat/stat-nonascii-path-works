# FEATURE: CONFIG_PLATFORM_MINGW32
# Test stat with non-ASCII characters in paths

BASEDIR=c:/temp/stat_nonascii_test$$

# e-acute = U+00E9, valid in both UTF-8 and CP1252
powershell.exe -Command "
\$e = [char]0x00e9
\$path = \"$BASEDIR/caf\`\${e}_dir\"
New-Item -Path \$path -ItemType Directory -Force | Out-Null
New-Item -Path (Join-Path \$path 'file.txt') -ItemType File -Force | Out-Null
Write-Host \$path
" > testpath.txt

TESTPATH=$(cat testpath.txt | tr '\\' '/' | tr -d '\r')

test -d "$BASEDIR" || { echo "directory creation failed"; exit 1; }
busybox stat "$TESTPATH" > /dev/null 2>&1 || { echo "stat failed on dir"; exit 1; }
busybox stat "$TESTPATH/file.txt" > /dev/null 2>&1 || { echo "stat failed on file"; exit 1; }
busybox rm -rf "$BASEDIR"
rm -f testpath.txt
